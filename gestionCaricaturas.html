<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Gestion Caricaturas</title>
</head>

<body style="background-color: #212529; margin: 2vh;">
    <h1 style="background-color: #032830; text-align: center; color: aquamarine;">Gestion de Caricaturas</h1>
    <div class="row">
        <div class="col-md-6">
            <h1 style="color: #37d1f6;">Ingreso de Caricaturas</h1>
            <form id="form-product-insert">
                <div class="row">
                    <div class="col-md-6">
                        <input id="nombreCaricatura" type="text" placeholder="Ingrese Nombre de caricatura" class="form-control"><br>
                        <input id="year" type="number" placeholder="Ingrese Año de lanzamiento" class="form-control"><br>
                        <input id="creador" type="text" placeholder="Ingrese Creador(es)" class="form-control"><br>
                        <input id="genero" type="text" placeholder="Ingrese Género" class="form-control"><br>
                        <input id="pais" type="text" placeholder="Ingrese País de origen" class="form-control"><br>
                    </div>
                    <div class="col-md-6">
                        <input id="personajes" type="text" placeholder="Ingrese Personajes principales" class="form-control"><br>
                        <input id="duracion" type="number" placeholder="Ingrese Duración de los episodios" class="form-control"><br>
                        <input id="temporadas" type="number" placeholder="Ingrese Número de temporadas" class="form-control"><br>
                        <input id="vigencia" type="text" placeholder="Ingrese Vigencia activa o inactiva" class="form-control"><br>
                        <input id="popularidad" type="text" placeholder="Ingrese Popularidad" class="form-control"><br>
                    </div>
                </div>
                <button type="submit" class="btn btn-outline-success btn-lg">Agregar Caricatura</button>
            </form>
        </div>
        <div class="col-md-6">
            <h1 style="color: #37d1f6;">Listado de Caricaturas</h1>
            <table id="caricaturas-table" class="table table-dark table-striped">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Año</th>
                        <th>Creador</th>
                        <th>Género</th>
                        <th>País</th>
                        <th>Personajes</th>
                        <th>Duración</th>
                        <th>Temporadas</th>
                        <th>Vigencia</th>
                        <th>Popularidad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se insertarán las filas de caricaturas -->
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, updateDoc, doc, getDoc } 
        from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id",
            measurementId: "your-measurement-id"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const productform = document.getElementById("form-product-insert");
        const tableBody = document.getElementById('caricaturas-table').getElementsByTagName('tbody')[0];

        // Función para agregar una caricatura
        const agregarCaricatura = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "caricaturas"), {
                nombre: productform.nombreCaricatura.value,
                year: productform.year.value,
                creador: productform.creador.value,
                genero: productform.genero.value,
                pais: productform.pais.value,
                personajes: productform.personajes.value,
                duracion: productform.duracion.value,
                temporadas: productform.temporadas.value,
                vigencia: productform.vigencia.value,
                popularidad: productform.popularidad.value,
            });
            productform.reset();
        };

        // Añadir evento para insertar caricatura solo una vez
        productform.addEventListener("submit", agregarCaricatura);

        // Función para cargar las caricaturas en la tabla
        const cargarCaricaturas = () => {
            onSnapshot(collection(db, "caricaturas"), (snapshot) => {
                tableBody.innerHTML = '';
                snapshot.forEach((doc) => {
                    const caricatura = doc.data();
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${caricatura.nombre}</td>
                        <td>${caricatura.year}</td>
                        <td>${caricatura.creador}</td>
                        <td>${caricatura.genero}</td>
                        <td>${caricatura.pais}</td>
                        <td>${caricatura.personajes}</td>
                        <td>${caricatura.duracion}</td>
                        <td>${caricatura.temporadas}</td>
                        <td>${caricatura.vigencia}</td>
                        <td>${caricatura.popularidad}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editarCaricatura('${doc.id}')">Editar</button>
                            <button class="btn btn-danger btn-sm" onclick="eliminarCaricatura('${doc.id}')">Eliminar</button>
                        </td>
                    `;
                });
            });
        };

        // Función para eliminar una caricatura
        const eliminarCaricatura = async (id) => {
            await deleteDoc(doc(db, "caricaturas", id));
        };

        // Función para editar una caricatura
        const editarCaricatura = async (id) => {
            const docRef = doc(db, "caricaturas", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const caricatura = docSnap.data();
                productform.nombreCaricatura.value = caricatura.nombre;
                productform.year.value = caricatura.year;
                productform.creador.value = caricatura.creador;
                productform.genero.value = caricatura.genero;
                productform.pais.value = caricatura.pais;
                productform.personajes.value = caricatura.personajes;
                productform.duracion.value = caricatura.duracion;
                productform.temporadas.value = caricatura.temporadas;
                productform.vigencia.value = caricatura.vigencia;
                productform.popularidad.value = caricatura.popularidad;

                productform.removeEventListener("submit", agregarCaricatura);
                productform.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    await updateDoc(docRef, {
                        nombre: productform.nombreCaricatura.value,
                        year: productform.year.value,
                        creador: productform.creador.value,
                        genero: productform.genero.value,
                        pais: productform.pais.value,
                        personajes: productform.personajes.value,
                        duracion: productform.duracion.value,
                        temporadas: productform.temporadas.value,
                        vigencia: productform.vigencia.value,
                        popularidad: productform.popularidad.value,
                    });
                    productform.reset();
                    productform.removeEventListener("submit", actualizarCaricatura);
                    productform.addEventListener("submit", agregarCaricatura);
                });
            }
        };

        cargarCaricaturas();

        window.eliminarCaricatura = eliminarCaricatura;
        window.editarCaricatura = editarCaricatura;
    </script>
</body>
</html>
