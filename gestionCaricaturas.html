<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Gestion Caricaturas</title>
</head>
<body>
    <h1>Gestion de Caricaturas</h1>
    <div class="row">
        <div class="col-md-6">
            <h1>Ingreso de Caricaturas</h1>
            <form id="form-product-insert">
                <input id="nombreCaricatura" type="text" placeholder="Ingrese Nombre de caricatura"><br>
                <input id="year" type="text" placeholder="Ingrese Año de lanzamiento"><br>
                <input id="creador" type="text" placeholder="Ingrese Creador(es)"><br>
                <input id="genero" type="text" placeholder="Ingrese Género"><br>
                <input id="pais" type="text" placeholder="Ingrese País de origen"><br>
                <input id="personajes" type="text" placeholder="Ingrese Personajes principales"><br>
                <input id="duracion" type="text" placeholder="Ingrese Duración de los episodios"><br>
                <input id="temporadas" type="text" placeholder="Ingrese Número de temporadas"><br>
                <input id="vigencia" type="text" placeholder="Ingrese Vigencia activa o innactiva"><br>
                <input id="popularidad" type="text" placeholder="Ingrese Popularidad"><br>
                <button type="submit">Agregar Caricatura</button>
            </form>
        </div>
        <div class="col-md-6">
            <h1>Eliminacion de caricatura</h1>
            <form id="form-product-delete">
                <input id="nombreCaricaturaDelete" type="text" placeholder="Ingrese Nombre de caricatura a eliminar"><br>
                <button type="submit">Eliminar</button>
            </form>
        </div>
        
    </div>
    <div class="row">
        <div class="col-md-6">
            
        </div>
        <div class="col-md-6">

        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
        import {getFirestore,collection,addDoc,onSnapshot,deleteDoc,doc}
        from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyBl98YMnGuEua8KD8aXPG2TeWlBz-7xEKA",
          authDomain: "futbol-953ae.firebaseapp.com",
          projectId: "futbol-953ae",
          storageBucket: "futbol-953ae.appspot.com",
          messagingSenderId: "580514350036",
          appId: "1:580514350036:web:e471b2d2e9485a52d10c41",
          measurementId: "G-F614L2EHS5"
        };
      
        // Initialize Firebase
        // INSERTAR CARICATURA
        const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            
            const productform = document.getElementById("form-product-insert");
            productform.addEventListener("submit", async (e) => {
                e.preventDefault();
                await addDoc(collection(db,"caricaturas"),{
                    nombre: productform.nombreCaricatura.value,
                    year: productform.year.value,
                    creador: productform.creador.value,
                    genero: productform.genero.value,
                    pais: productform.pais.value,
                    personajes: productform.personajes.value,
                    duracion: productform.duracion.value,
                    temporadas: productform.temporadas.value,
                    vigencia: productform.vigencia.value,
                    popularidad: productform.popularidad.value,
                });
                productform.reset();
            });

            // ELIMINAR CARICATURA
            const productform1 = document.getElementById("form-product-delete");
            productform1.addEventListener("submit", async (e) => {
                e.preventDefault();
                try {
                    // Obtiene el nombre de la caricatura que deseas eliminar
                    const nombreCaricaturaDelete = productform1.nombreCaricaturaDelete.value;

                    // Verifica que el nombre de la caricatura no esté vacío
                    if (!nombreCaricaturaDelete) {
                        console.error("El nombre de la caricatura no puede estar vacío");
                        return;
                    }

                    // Consulta la colección "caricaturas" para encontrar el documento que coincida con el nombre de la caricatura
                    const caricaturaQuery = query(collection(db, "caricaturas"), where("nombre", "==", nombreCaricaturaDelete));
                    const querySnapshot = await getDocs(caricaturaQuery);

                    // Verifica si existen documentos con ese nombre
                    if (querySnapshot.empty) {
                        console.log("No se encontraron caricaturas con ese nombre.");
                        return;
                    }

                    // Itera sobre los documentos que coinciden con el nombre de la caricatura y los elimina
                    for (const doc of querySnapshot.docs) {
                        await deleteDoc(doc.ref);
                        console.log("Documento eliminado correctamente");
                    }

                    // Resetea el formulario después de eliminar los documentos
                    productform1.reset();
                } catch (error) {
                    console.error("Error al eliminar documento: ", error);
                }
            });
      </script>
</body>
</html>