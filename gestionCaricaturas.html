<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Gestion Caricaturas</title>
</head>
<body style="background-color: #212529; margin: 2vh;">
    <h1 style="background-color: #032830; text-align: center;color: aquamarine;">Gestion de Caricaturas</h1>
    <div class="row">
        <div class="col-md-6">
            <h1 style="color: #37d1f6;">Ingreso de Caricaturas</h1>
            <form id="form-product-insert">
                <div class="row">
                    <div class="col-md-6">
                        <input id="nombreCaricatura" type="text" placeholder="Ingrese Nombre de caricatura" class="form-control"><br>
                        <input id="year" type="number" placeholder="Ingrese Año de lanzamiento" class="form-control"><br>
                        <input id="creador" type="text" placeholder="Ingrese Creador(es)" class="form-control"><br>
                        <input id="genero" type="text" placeholder="Ingrese Género" class="form-control"><br>
                        <input id="pais" type="text" placeholder="Ingrese País de origen" class="form-control"><br>
                    </div>
                    <div class="col-md-6">
                        <input id="personajes" type="text" placeholder="Ingrese Personajes principales" class="form-control"><br>
                        <input id="duracion" type="number" placeholder="Ingrese Duración de los episodios" class="form-control"><br>
                        <input id="temporadas" type="number" placeholder="Ingrese Número de temporadas" class="form-control"><br>
                        <input id="vigencia" type="text" placeholder="Ingrese Vigencia activa o innactiva" class="form-control"><br>
                        <input id="popularidad" type="text" placeholder="Ingrese Popularidad" class="form-control"><br>
                    </div>        
                </div>
                <button type="submit" class="btn btn-outline-success btn-lg">Agregar Caricatura</button>
            </form>
        </div>
        
    </div>
    <div class="row">
        <div class="col-md-6">
            <h1 style="color: #37d1f6;">Actualizacion de caricatura</h1>
            <form id="form-product-update">
                <input id="nombreCaricaturaBuscar" type="text" placeholder="Ingrese Nombre de caricatura a actualizar" class="form-control"><br>
                <div class="row">
                    <div class="col-md-6">
                        <input id="nombreCaricaturaUpdate" type="text" placeholder="Ingrese nuevo Nombre de caricatura" class="form-control"><br>
                        <input id="yearUpdate" type="number" placeholder="Ingrese nuevo Año de lanzamiento" class="form-control"><br>
                        <input id="creadorUpdate" type="text" placeholder="Ingrese nuevo Creador(es)" class="form-control"><br>
                        <input id="generoUpdate" type="text" placeholder="Ingrese nuevo Género" class="form-control"><br>
                        <input id="paisUpdate" type="text" placeholder="Ingrese nuevo País de origen" class="form-control"><br>
                    </div>
                    <div class="col-md-6">
                        <input id="personajesUpdate" type="text" placeholder="Ingrese nuevo Personajes principales" class="form-control"><br>
                        <input id="duracionUpdate" type="number" placeholder="Ingrese nuevo Duración de los episodios" class="form-control"><br>
                        <input id="temporadasUpdate" type="number" placeholder="Ingrese nuevo Número de temporadas" class="form-control"><br>
                        <input id="vigenciaUpdate" type="text" placeholder="Ingrese nuevo Vigencia activa o innactiva" class="form-control"><br>
                        <input id="popularidadUpdate" type="text" placeholder="Ingrese nuevo Popularidad" class="form-control"><br>
                    </div>
                </div>
                <button type="submit" class="btn btn-outline-info">Actualizar Caricatura</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h1 style="color: #37d1f6;">Datos de Caricaturas</h1>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Año</th>
                        <th>Creador(es)</th>
                        <th>Género</th>
                        <th>País</th>
                        <th>Personajes</th>
                        <th>Duración</th>
                        <th>Temporadas</th>
                        <th>Vigencia</th>
                        <th>Popularidad</th>
                        <th>OPCION</th>
                    </tr>
                </thead>
                <tbody id="caricaturasTableBody"></tbody>
            </table>
        </div>
    </div>
    

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, query, where, getDocs, updateDoc, doc } 
        from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
        apiKey: "AIzaSyBl98YMnGuEua8KD8aXPG2TeWlBz-7xEKA",
        authDomain: "futbol-953ae.firebaseapp.com",
        projectId: "futbol-953ae",
        storageBucket: "futbol-953ae.appspot.com",
        messagingSenderId: "580514350036",
        appId: "1:580514350036:web:e471b2d2e9485a52d10c41",
        measurementId: "G-F614L2EHS5"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        // INSERTAR CARICATURA
        const productform = document.getElementById("form-product-insert");
            productform.addEventListener("submit", async (e) => {
                e.preventDefault();
                await addDoc(collection(db,"caricaturas"),{
                    nombre: productform.nombreCaricatura.value,
                    year: productform.year.value,
                    creador: productform.creador.value,
                    genero: productform.genero.value,
                    pais: productform.pais.value,
                    personajes: productform.personajes.value,
                    duracion: productform.duracion.value,
                    temporadas: productform.temporadas.value,
                    vigencia: productform.vigencia.value,
                    popularidad: productform.popularidad.value,
                });
                productform.reset();
            });

            // ELIMINAR CARICATURA
            // Función para eliminar una caricatura
            async function eliminarCaricatura(docId) {
                try {
                    // Eliminar la caricatura de la base de datos
                    await deleteDoc(doc(db, "caricaturas", docId));
                    console.log("Caricatura eliminada correctamente de la base de datos");

                    // Eliminar la fila correspondiente de la tabla
                    const row = document.getElementById(docId);
                    if (row) {
                        row.remove();
                        console.log("Fila de la tabla eliminada correctamente");
                    } else {
                        console.error("No se encontró la fila de la tabla");
                    }
                } catch (error) {
                    console.error("Error al eliminar caricatura: ", error);
                }
            }

            // Escuchar clics en la tabla para manejar los clics en los botones de eliminar
            document.getElementById("caricaturasTableBody").addEventListener("click", function(event) {
                // Comprobar si el clic ocurrió en un botón de eliminar
                if (event.target.classList.contains("btn-eliminar")) {
                    // Obtener el ID del documento de la fila
                    const docId = event.target.closest("tr").id;
                    // Llamar a la función eliminarCaricatura con el ID del documento
                    eliminarCaricatura(docId);
                }
            });

            //ACTUALIZAR CARICATURA
            
            // Obtener referencia al formulario
const productform2 = document.getElementById("form-product-update");

// Agregar evento de envío al formulario
productform2.addEventListener("submit", async (e) => {
    e.preventDefault(); // Prevenir comportamiento por defecto del formulario

    try {
        // Obtener el valor del nombre de la caricatura
        const nombreCaricaturaBuscar = productform2.nombreCaricaturaBuscar.value;

        // Validar que el campo de nombre no esté vacío
        if (!nombreCaricaturaBuscar) {
            console.error("El nombre de la caricatura no puede estar vacío");
            return;
        }

        // Consultar la base de datos para buscar la caricatura por su nombre
        const caricaturaQuery = query(collection(db, "caricaturas"), where("nombre", "==", nombreCaricaturaBuscar));
        const querySnapshot = await getDocs(caricaturaQuery);

        // Verificar si no se encontraron resultados
        if (querySnapshot.empty) {
            console.log("No se encontraron caricaturas con ese nombre.");
            return;
        }

        // Obtener referencia al documento encontrado
        const docRef = querySnapshot.docs[0].ref;

        // Actualizar el documento con los nuevos valores del formulario
        await updateDoc(docRef, {
            nombre: productform2.nombreCaricaturaUpdate.value,
            year: productform2.yearUpdate.value,
            creador: productform2.creadorUpdate.value,
            genero: productform2.generoUpdate.value,
            pais: productform2.paisUpdate.value,
            personajes: productform2.personajesUpdate.value,
            duracion: productform2.duracionUpdate.value,
            temporadas: productform2.temporadasUpdate.value,
            vigencia: productform2.vigenciaUpdate.value,
            popularidad: productform2.popularidadUpdate.value,
        });

        // Confirmar que el documento se actualizó correctamente
        console.log("Documento actualizado correctamente");

        // Limpiar el formulario después de la actualización
        productform2.reset();
    } catch (error) {
        console.error("Error al actualizar documento: ", error);
    }
});

            
            
            
                //AAAAAAAAAAAAAAAAA
                const caricaturasTableBody = document.getElementById("caricaturasTableBody");

                function mostrarDatosEnTabla(snapshot) {
                    caricaturasTableBody.innerHTML = ""; 

                    snapshot.forEach((doc) => {
                        const caricaturaData = doc.data();
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${caricaturaData.nombre}</td>
                            <td>${caricaturaData.year}</td>
                            <td>${caricaturaData.creador}</td>
                            <td>${caricaturaData.genero}</td>
                            <td>${caricaturaData.pais}</td>
                            <td>${caricaturaData.personajes}</td>
                            <td>${caricaturaData.duracion}</td>
                            <td>${caricaturaData.temporadas}</td>
                            <td>${caricaturaData.vigencia}</td>
                            <td>${caricaturaData.popularidad}</td>
                            <td>
                                <button data-doc-id="${doc.id}" class="btn-eliminar btn btn-danger">Eliminar</button>
                                <button data-doc-id="${doc.id}" class="btn-guardar btn btn-success">Guardar</button>
                            </td>
                        `;
                        caricaturasTableBody.appendChild(row);
                    });
                }

                // Escuchar clics en la tabla para manejar los clics en los botones de eliminar
                caricaturasTableBody.addEventListener("click", function(event) {
                    // Comprobar si el clic ocurrió en un botón de eliminar
                    if (event.target.classList.contains("btn-eliminar")) {
                        // Obtener el ID del documento de la caricatura
                        const docId = event.target.getAttribute('data-doc-id');
                        // Llamar a la función eliminarCaricatura con el ID del documento
                        eliminarCaricatura(docId);
                    }

                });

                onSnapshot(collection(db, "caricaturas"), (snapshot) => {
                    mostrarDatosEnTabla(snapshot);
                });

                getDocs(collection(db, "caricaturas")).then((snapshot) => {
                    mostrarDatosEnTabla(snapshot);
                });

// Obtener referencia al botón de guardar
const btnGuardar = document.getElementById("btnGuardar");

// Obtener referencia al modal
const modal = document.getElementById("myModal");

// Obtener la referencia del elemento de cierre del modal
const span = document.getElementsByClassName("close")[0];

// Agregar evento de clic al botón de guardar
btnGuardar.addEventListener("click", () => {
  // Mostrar el modal cuando se haga clic en el botón de guardar
  modal.style.display = "block";
});

// Agregar evento de clic al elemento de cierre del modal
span.addEventListener("click", () => {
  // Ocultar el modal cuando se haga clic en el elemento de cierre
  modal.style.display = "none";
});

// También puedes cerrar el modal si el usuario hace clic fuera de él
window.addEventListener("click", (event) => {
  if (event.target === modal) {
    modal.style.display = "none";
  }
});

            
        </script>
</body>
</html>
