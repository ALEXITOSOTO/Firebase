<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Gestion Caricaturas</title>
</head>

<body style="background-color: #212529; margin: 2vh;">
    <h1 style="background-color: #032830; text-align: center; color: aquamarine;">Gestion de Caricaturas</h1>
    <div class="row">
        <div class="col-md-6">
            <h1 style="color: #37d1f6;">Ingreso de Caricaturas</h1>
            <form id="form-product-insert">
                <div class="row">
                    <div class="col-md-6">
                        <input id="nombreCaricatura" type="text" placeholder="Ingrese Nombre de caricatura" class="form-control" required><br>
                        <input id="year" type="number" placeholder="Ingrese Año de lanzamiento" class="form-control" required><br>
                        <input id="creador" type="text" placeholder="Ingrese Creador(es)" class="form-control" required><br>
                        <input id="genero" type="text" placeholder="Ingrese Género" class="form-control" required><br>
                        <input id="pais" type="text" placeholder="Ingrese País de origen" class="form-control" required><br>
                    </div>
                    <div class="col-md-6">
                        <input id="personajes" type="text" placeholder="Ingrese Personajes principales" class="form-control" required><br>
                        <input id="duracion" type="number" placeholder="Ingrese Duración de los episodios" class="form-control" required><br>
                        <input id="temporadas" type="number" placeholder="Ingrese Número de temporadas" class="form-control" required><br>
                        <input id="vigencia" type="text" placeholder="Ingrese Vigencia activa o inactiva" class="form-control" required><br>
                        <input id="popularidad" type="text" placeholder="Ingrese Popularidad" class="form-control" required><br>
                    </div>
                </div>
                <button type="submit" class="btn btn-outline-success btn-lg">Agregar Caricatura</button>
            </form>
        </div>
        <div class="col-md-6">
            <h1 style="color: #37d1f6;">Listado de Caricaturas</h1>
            <table id="caricaturas-table" class="table table-dark table-striped">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Año</th>
                        <th>Creador</th>
                        <th>Género</th>
                        <th>País</th>
                        <th>Personajes</th>
                        <th>Duración</th>
                        <th>Temporadas</th>
                        <th>Vigencia</th>
                        <th>Popularidad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se insertarán las filas de caricaturas -->
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, updateDoc, doc, getDoc } 
        from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id",
            measurementId: "your-measurement-id"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const productform = document.getElementById("form-product-insert");
        const tableBody = document.getElementById('caricaturas-table').getElementsByTagName('tbody')[0];

        // Función para agregar una caricatura
        const agregarCaricatura = async (e) => {
            e.preventDefault();
            try {
                await addDoc(collection(db, "caricaturas"), {
                    nombre: productform.nombreCaricatura.value,
                    year: productform.year.value,
                    creador: productform.creador.value,
                    genero: productform.genero.value,
                    pais: productform.pais.value,
                    personajes: productform.personajes.value,
                    duracion: productform.duracion.value,
                    temporadas: productform.temporadas.value,
                    vigencia: productform.vigencia.value,
                    popularidad: productform.popularidad.value,
                });
                productform.reset();
            } catch (error) {
                console.error("Error al agregar caricatura: ", error);
            }
        };

        // Añadir evento para insertar caricatura solo una vez
        productform.addEventListener("submit", agregarCaricatura);

        // Función para cargar las caricaturas en la tabla
        const cargarCaricaturas = () => {
            onSnapshot(collection(db, "caricaturas"), (snapshot) => {
                tableBody.innerHTML = '';
                snapshot.forEach((doc) => {
                    const caricatura = doc.data();
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td contenteditable="true">${caricatura.nombre}</td>
                        <td contenteditable="true">${caricatura.year}</td>
                        <td contenteditable="true">${caricatura.creador}</td>
                        <td contenteditable="true">${caricatura.genero}</td>
                        <td contenteditable="true">${caricatura.pais}</td>
                        <td contenteditable="true">${caricatura.personajes}</td>
                        <td contenteditable="true">${caricatura.duracion}</td>
                        <td contenteditable="true">${caricatura.temporadas}</td>
                        <td contenteditable="true">${caricatura.vigencia}</td>
                        <td contenteditable="true">${caricatura.popularidad}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick
                            onclick="guardarEdicion(this, '${doc.id}')">Guardar</button>
                            <button class="btn btn-danger btn-sm" onclick="eliminarCaricatura('${doc.id}')">Eliminar</button>
                        </td>
                    `;
                });
            });
        };

        // Función para guardar la edición de una caricatura
        const guardarEdicion = async (button, id) => {
            const row = button.closest('tr');
            const updatedCaricatura = {
                nombre: row.cells[0].innerText,
                year: row.cells[1].innerText,
                creador: row.cells[2].innerText,
                genero: row.cells[3].innerText,
                pais: row.cells[4].innerText,
                personajes: row.cells[5].innerText,
                duracion: row.cells[6].innerText,
                temporadas: row.cells[7].innerText,
                vigencia: row.cells[8].innerText,
                popularidad: row.cells[9].innerText
            };

            try {
                const docRef = doc(db, "caricaturas", id);
                await updateDoc(docRef, updatedCaricatura);
            } catch (error) {
                console.error("Error al actualizar caricatura: ", error);
            }
        };

        // Función para eliminar una caricatura
        const eliminarCaricatura = async (id) => {
            try {
                await deleteDoc(doc(db, "caricaturas", id));
            } catch (error) {
                console.error("Error al eliminar caricatura: ", error);
            }
        };

        cargarCaricaturas();
        window.eliminarCaricatura = eliminarCaricatura;
        window.guardarEdicion = guardarEdicion;
    </script>
</body>
</html>
